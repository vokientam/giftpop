<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Gaussian Filter</title>

    <script>
        document.addEventListener('DOMContentLoaded', function(){
        var v = document.getElementById('videoOrigin');
        var canvas = document.getElementById('videoResult');
        var context = canvas.getContext('2d');
        var back = document.createElement('canvas');
        var backcontext = back.getContext('2d');

        var cw,ch;

        v.addEventListener('play', function(){
            cw = v.clientWidth;
            ch = v.clientHeight;
            canvas.width = cw;
            canvas.height = ch;
            back.width = cw;
            back.height = ch;
            draw(v,context,backcontext,cw,ch);
        },false);

      },false);


      function draw(v,c,bc,w,h) {
        if(v.paused || v.ended) return false;
        // First, draw it into the backing canvas
        bc.drawImage(v,0,0,w,h);
        // Grab the pixel data from the backing canvas
        var idata = bc.getImageData(0,0,w,h);
        var data = idata.data;
        // Create Gaussian array
        var arrGauss = [1, 2, 1,
                        2, 4, 2,
                        1, 2, 1];

        // Apply Gaussian filter

        console.log(data.length,' ',w, h);
        var cw = w * 4;
        var arrRedPixel1 = [0, 0, 0,
                             0, 0, 0,
                             0, 0, 0];
         arrRedPixel1[0] = data[601 - cw - 4];
         arrRedPixel1[1] = data[601 - cw];
         arrRedPixel1[2] = data[601 - cw + 4];
         arrRedPixel1[3] = data[601 - 4];
         arrRedPixel1[4] = data[601];
         arrRedPixel1[5] = data[601 + 4];
         arrRedPixel1[6] = data[601 + cw - 4];
         arrRedPixel1[7] = data[601 + cw];
         arrRedPixel1[8] = data[601 + cw + 4];
         var newRedValue1 = 0;

         for (var g = 0; g < 9; g++)
         {
           newRedValue1 += arrRedPixel1[i] * arrGauss[i];
         }

         newRedValue1 = newRedValue1 / 16;
         console.log(arrRedPixel1, newRedValue1);

        for(var i = cw + 4; i < data.length - cw - 4; i += 4) {
          //Red
          var arrRedPixel = [0, 0, 0,
                               0, 0, 0,
                               0, 0, 0];
          arrRedPixel[0] = data[i - cw - 4];
          arrRedPixel[1] = data[i - cw];
          arrRedPixel[2] = data[i - cw + 4];
          arrRedPixel[3] = data[i - 4];
          arrRedPixel[4] = data[i];
          arrRedPixel[5] = data[i + 4];
          arrRedPixel[6] = data[i + cw - 4];
          arrRedPixel[7] = data[i + cw];
          arrRedPixel[8] = data[i + cw + 4];

          var newRedValue = 0;

          for (var g = 0; g < 9; g++)
          {
            newRedValue += arrRedPixel[i] * arrGauss[i];
          }

          newRedValue = newRedValue / 16;

          data[i] = newRedValue;
          //Green
          var PixelG1 = data[i - cw - 4 + 1];
          var PixelG2 = data[i - cw + 1];
          var PixelG3 = data[i - cw + 4 + 1];
          var PixelG4 = data[i - 4 + 1];
          var PixelG5 = data[i + 1];
          var PixelG6 = data[i + 4 + 1];
          var PixelG7 = data[i + cw - 4 + 1];
          var PixelG8 = data[i + cw + 1];
          var PixelG9 = data[i + cw + 4 + 1];
          var arrGreenPixel = [ PixelG1, PixelG2, PixelG3,
                              PixelG4, PixelG5, PixelG6,
                              PixelG7, PixelG8, PixelG9]
          var newGreenValue = 0;
          for (var g = 0; g < 10; g++)
          {
            newGreenValue += arrGreenPixel[i] * arrGauss[i];
          }
          newGreenValue = newGreenValue / 16;
          data[i + 1] = newGreenValue;
          //Blue
          var PixelB1 = data[i - cw - 4 + 2];
          var PixelB2 = data[i - cw + 2];
          var PixelB3 = data[i - cw + 4 + 2];
          var PixelB4 = data[i - 4 + 2];
          var PixelB5 = data[i + 2];
          var PixelB6 = data[i + 4 + 2];
          var PixelB7 = data[i + cw - 4 + 2];
          var PixelB8 = data[i + cw + 2];
          var PixelB9 = data[i + cw + 4 + 2];
          var arrBluePixel = [ PixelB1, PixelB2, PixelB3,
                              PixelB4, PixelB5, PixelB6,
                              PixelB7, PixelB8, PixelB9]
          var newBlueValue = 0;
          for (var g = 0; g < 10; g++)
          {
            newBlueValue += arrBluePixel[i] * arrGauss[i];
          }
          newBlueValue = newBlueValue / 16;
          data[i + 2] = newBlueValue;
        }
        idata.data = data;
        // Draw the pixels onto the visible canvas
        c.putImageData(idata,0,0);
        // Start over!
        setTimeout(function(){ draw(v,c,bc,w,h); }, 0);
      }

    </script>
  </head>
  <body>
    <video id="videoOrigin" width = "600px" height="300px" controls loop>
        <source src=nupogodi.mp4 type=video/mp4>
    </video>
    <canvas id="videoResult">

    </canvas>
  </body>

</html>
